<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://21up.github.io</id>
    <title>Gridea</title>
    <updated>2022-02-26T08:42:50.185Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://21up.github.io"/>
    <link rel="self" href="https://21up.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://21up.github.io/images/avatar.png</logo>
    <icon>https://21up.github.io/favicon.ico</icon>
    <rights>All rights reserved 2022, Gridea</rights>
    <entry>
        <title type="html"><![CDATA[å•ä¾‹æ¨¡å¼]]></title>
        <id>https://21up.github.io/post/dan-li-mo-shi/</id>
        <link href="https://21up.github.io/post/dan-li-mo-shi/">
        </link>
        <updated>2021-12-06T10:20:15.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æ¦‚å¿µä»‹ç»">æ¦‚å¿µä»‹ç»</h2>
<p>æ‰€è°“ç±»çš„å•ä¾‹è®¾è®¡æ¨¡å¼ï¼Œå°±æ˜¯é‡‡å–ä¸€å®šçš„æ–¹æ³•ä¿è¯åœ¨æ•´ä¸ªçš„è½¯ä»¶ç³»ç»Ÿä¸­ï¼Œå¯¹æŸä¸ªç±»åªèƒ½å­˜åœ¨ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œ å¹¶ä¸”è¯¥ç±»åªæä¾›ä¸€ä¸ªå–å¾—å…¶å¯¹è±¡å®ä¾‹çš„æ–¹æ³•(é™æ€æ–¹æ³•)ã€‚</p>
<p>æ¯”å¦‚Hibernate çš„ SessionFactoryï¼Œå®ƒå……å½“æ•°æ®å­˜å‚¨æºçš„ä»£ç†ï¼Œå¹¶è´Ÿè´£åˆ›å»º Session å¯¹è±¡ã€‚SessionFactory å¹¶ä¸æ˜¯ è½»é‡çº§çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé¡¹ç›®é€šå¸¸åªéœ€è¦ä¸€ä¸ª SessionFactory å°±å¤Ÿï¼Œè¿™æ˜¯å°±ä¼šä½¿ç”¨åˆ°å•ä¾‹æ¨¡å¼ã€‚</p>
<h2 id="å‡ ç§å®ç°å•ä¾‹çš„æ–¹å¼">å‡ ç§å®ç°å•ä¾‹çš„æ–¹å¼</h2>
<ol>
<li>é¥¿æ±‰å¼(é™æ€å˜é‡)</li>
<li>é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰</li>
<li>æ‡’æ±‰å¼(çº¿ç¨‹ä¸å®‰å…¨)</li>
<li>æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)</li>
<li>æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—)</li>
<li>åŒé‡æ£€æŸ¥</li>
<li>é™æ€å†…éƒ¨ç±»</li>
<li>æšä¸¾</li>
</ol>
<h3 id="é¥¿æ±‰å¼é™æ€å˜é‡">é¥¿æ±‰å¼(é™æ€å˜é‡)</h3>
<pre><code>class Singleton {
      
    //1. æ„é€ å™¨ç§æœ‰åŒ–, å¤–éƒ¨ä¸èƒ½new
    private Singleton() {
          
    }
      
    //2.æœ¬ç±»å†…éƒ¨åˆ›å»ºå¯¹è±¡å®ä¾‹
    private final static Singleton instance = new Singleton();
      
    //3. æä¾›ä¸€ä¸ªå…¬æœ‰çš„é™æ€æ–¹æ³•ï¼Œè¿”å›å®ä¾‹å¯¹è±¡
    public static Singleton getInstance() {
        return instance;
    }
      
}
</code></pre>
<ol>
<li>
<p>ä¼˜ç‚¹ï¼šè¿™ç§å†™æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚</p>
</li>
<li>
<p>ç¼ºç‚¹ï¼šåœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ï¼Œæ²¡æœ‰è¾¾åˆ° Lazy Loading çš„æ•ˆæœã€‚å¦‚æœä»å§‹è‡³ç»ˆä»æœªä½¿ç”¨è¿‡è¿™ä¸ªå®ä¾‹ï¼Œåˆ™ ä¼šé€ æˆå†…å­˜çš„æµªè´¹</p>
<p>è¿™ç§æ–¹å¼åŸºäº classloder æœºåˆ¶é¿å…äº†å¤šçº¿ç¨‹çš„åŒæ­¥é—®é¢˜ï¼Œä¸è¿‡ï¼Œinstance åœ¨ç±»è£…è½½æ—¶å°±å®ä¾‹åŒ–ï¼Œåœ¨å•ä¾‹æ¨¡å¼ä¸­å¤§ å¤šæ•°éƒ½æ˜¯è°ƒç”¨ getInstance æ–¹æ³•ï¼Œä½†æ˜¯å¯¼è‡´ç±»è£…è½½çš„åŸå› æœ‰å¾ˆå¤šç§ï¼Œå› æ­¤ä¸èƒ½ç¡®å®šæœ‰å…¶ä»–çš„æ–¹å¼ï¼ˆæˆ–è€…å…¶ä»–çš„é™ æ€æ–¹æ³•ï¼‰å¯¼è‡´ç±»è£…è½½ï¼Œè¿™æ—¶å€™åˆå§‹åŒ– instance å°±æ²¡æœ‰è¾¾åˆ° lazy loading çš„æ•ˆæœ</p>
</li>
<li>
<p>ç»“è®ºï¼šè¿™ç§å•ä¾‹æ¨¡å¼å¯ç”¨ï¼Œå¯èƒ½é€ æˆå†…å­˜æµªè´¹</p>
</li>
</ol>
<h3 id="é¥¿æ±‰å¼é™æ€ä»£ç å—">é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰</h3>
<pre><code>class Singleton {

    //1. æ„é€ å™¨ç§æœ‰åŒ–, å¤–éƒ¨ä¸èƒ½new
    private Singleton() {

    }

    //2.æœ¬ç±»å†…éƒ¨åˆ›å»ºå¯¹è±¡å®ä¾‹
    private static Singleton instance;

    static { // åœ¨é™æ€ä»£ç å—ä¸­ï¼Œåˆ›å»ºå•ä¾‹å¯¹è±¡
        instance = new Singleton();
    }

    //3. æä¾›ä¸€ä¸ªå…¬æœ‰çš„é™æ€æ–¹æ³•ï¼Œè¿”å›å®ä¾‹å¯¹è±¡
    public static Singleton getInstance() {
        return instance;
    }

}
</code></pre>
<ol>
<li>è¿™ç§æ–¹å¼å’Œä¸Šé¢çš„æ–¹å¼å…¶å®ç±»ä¼¼ï¼Œåªä¸è¿‡å°†ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹æ”¾åœ¨äº†é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™ï¼Œå°±æ‰§ è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œåˆå§‹åŒ–ç±»çš„å®ä¾‹ã€‚ä¼˜ç¼ºç‚¹å’Œä¸Šé¢æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>ç»“è®ºï¼šè¿™ç§å•ä¾‹æ¨¡å¼å¯ç”¨ï¼Œä½†æ˜¯å¯èƒ½é€ æˆå†…å­˜æµªè´¹</li>
</ol>
<h3 id="æ‡’æ±‰å¼çº¿ç¨‹ä¸å®‰å…¨">æ‡’æ±‰å¼(çº¿ç¨‹ä¸å®‰å…¨)</h3>
<pre><code>class Singleton {
    private static Singleton instance;

    private Singleton() {}

    //æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼Œå½“ä½¿ç”¨åˆ°è¯¥æ–¹æ³•æ—¶ï¼Œæ‰å»åˆ›å»º instance,è¿™ç§æ–¹å¼å³æ‡’æ±‰å¼
    public static Singleton getInstance() {
        if(instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
</code></pre>
<ol>
<li>èµ·åˆ°äº† Lazy Loading çš„æ•ˆæœï¼Œä½†æ˜¯åªèƒ½åœ¨å•çº¿ç¨‹ä¸‹ä½¿ç”¨ã€‚</li>
<li>å¦‚æœåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº† if (singleton == null)åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡ äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œè¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®ä¾‹ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å¯ä½¿ç”¨è¿™ç§æ–¹å¼</li>
<li>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸è¦ä½¿ç”¨è¿™ç§æ–¹å¼.</li>
</ol>
<h3 id="æ‡’æ±‰å¼çº¿ç¨‹å®‰å…¨åŒæ­¥æ–¹æ³•">æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)</h3>
<pre><code>class Singleton {
    private static Singleton instance;

    private Singleton() {
    }
    //æ³¨æ„åŠ é”äº†
    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
</code></pre>
<ol>
<li>è§£å†³äº†çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
<li>æ•ˆç‡å¤ªä½äº†ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨æƒ³è·å¾—ç±»çš„å®ä¾‹æ—¶å€™ï¼Œæ‰§è¡Œ getInstance()æ–¹æ³•éƒ½è¦è¿›è¡ŒåŒæ­¥ã€‚è€Œå…¶å®è¿™ä¸ªæ–¹æ³•åªæ‰§è¡Œ ä¸€æ¬¡å®ä¾‹åŒ–ä»£ç å°±å¤Ÿäº†ï¼Œåé¢çš„æƒ³è·å¾—è¯¥ç±»å®ä¾‹ï¼Œç›´æ¥ return å°±è¡Œäº†ã€‚æ–¹æ³•è¿›è¡ŒåŒæ­¥æ•ˆç‡å¤ªä½</li>
<li>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸æ¨èä½¿ç”¨è¿™ç§æ–¹å¼</li>
</ol>
<h3 id="æ‡’æ±‰å¼çº¿ç¨‹å®‰å…¨åŒæ­¥ä»£ç å—">æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—)</h3>
<pre><code>class Singleton {
    private static Singleton instance;

    private Singleton() {
    }
    public static  Singleton getInstance() {
        if (instance == null) {
            //æ³¨æ„åŠ é”çš„ä½ç½®
            synchronized (Singleton.class){
                instance = new Singleton();
            }
        }
        return instance;
    }
}
</code></pre>
<p>ä¸æ¨èä½¿ç”¨</p>
<h3 id="åŒé‡æ£€æŸ¥">åŒé‡æ£€æŸ¥</h3>
<pre><code>class Singleton {
    private static volatile Singleton instance;

    private Singleton() {
    }

    //æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼ŒåŠ å…¥åŒé‡æ£€æŸ¥ä»£ç ï¼Œè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜, åŒæ—¶è§£å†³æ‡’åŠ è½½é—®é¢˜
    //åŒæ—¶ä¿è¯äº†æ•ˆç‡, æ¨èä½¿ç”¨
    public static synchronized Singleton getInstance() {
        if (instance == null) {
            synchronized (Singleton.class) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
</code></pre>
<ol>
<li>Double-Check æ¦‚å¿µæ˜¯å¤šçº¿ç¨‹å¼€å‘ä¸­å¸¸ä½¿ç”¨åˆ°çš„ï¼Œå¦‚ä»£ç ä¸­æ‰€ç¤ºï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸¤æ¬¡ if (singleton == null)æ£€æŸ¥ï¼Œè¿™ æ ·å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚</li>
<li>è¿™æ ·ï¼Œå®ä¾‹åŒ–ä»£ç åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼Œåé¢å†æ¬¡è®¿é—®æ—¶ï¼Œåˆ¤æ–­ if (singleton == null)ï¼Œç›´æ¥ return å®ä¾‹åŒ–å¯¹è±¡ï¼Œä¹Ÿé¿ å…äº†åå¤è¿›è¡Œæ–¹æ³•åŒæ­¥.</li>
<li>çº¿ç¨‹å®‰å…¨ï¼›å»¶è¿ŸåŠ è½½ï¼›æ•ˆç‡è¾ƒé«˜</li>
<li>ç»“è®ºï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œæ¨èä½¿ç”¨è¿™ç§å•ä¾‹è®¾è®¡æ¨¡å¼</li>
</ol>
<h3 id="é™æ€å†…éƒ¨ç±»">é™æ€å†…éƒ¨ç±»</h3>
<pre><code>class Singleton {
    private static volatile Singleton instance;

    //æ„é€ å™¨ç§æœ‰åŒ–
    private Singleton() {
    }

    //å†™ä¸€ä¸ªé™æ€å†…éƒ¨ç±»,è¯¥ç±»ä¸­æœ‰ä¸€ä¸ªé™æ€å±æ€§ Singleton
    private static class SingletonInstance {
        private static final Singleton INSTANCE = new Singleton();
    }

    //æä¾›ä¸€ä¸ªé™æ€çš„å…¬æœ‰æ–¹æ³•ï¼Œç›´æ¥è¿”å›SingletonInstance.INSTANCE

    public static synchronized Singleton getInstance() {

        return SingletonInstance.INSTANCE;
    }
}
</code></pre>
<ol>
<li>è¿™ç§æ–¹å¼é‡‡ç”¨äº†ç±»è£…è½½çš„æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ–å®ä¾‹æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹</li>
<li>é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨ Singleton ç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨ getInstance æ–¹æ³•ï¼Œæ‰ ä¼šè£…è½½ SingletonInstance ç±»ï¼Œä»è€Œå®Œæˆ Singleton çš„å®ä¾‹åŒ–ã€‚</li>
<li>ç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼ŒJVMå¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»è¿›è¡Œ åˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚</li>
<li>ä¼˜ç‚¹ï¼šé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨ï¼Œåˆ©ç”¨é™æ€å†…éƒ¨ç±»ç‰¹ç‚¹å®ç°å»¶è¿ŸåŠ è½½ï¼Œæ•ˆç‡é«˜</li>
<li>ç»“è®ºï¼šæ¨èä½¿ç”¨.</li>
</ol>
<h3 id="æšä¸¾">æšä¸¾</h3>
<pre><code>public class SingletonTest08 {
    public static void main(String[] args) {
        Singleton instance = Singleton.INSTANCE;
        Singleton instance2 = Singleton.INSTANCE;
        System.out.println(instance == instance2);

        System.out.println(instance.hashCode());
        System.out.println(instance2.hashCode());

        instance.sayOK();
    }
}

//ä½¿ç”¨æšä¸¾ï¼Œå¯ä»¥å®ç°å•ä¾‹, æ¨è
enum Singleton {
    INSTANCE; //å±æ€§

    public void sayOK() {
        System.out.println(&quot;ok~&quot;);
    }
}
</code></pre>
<ol>
<li>
<p>è¿™å€ŸåŠ© JDK1.5 ä¸­æ·»åŠ çš„æšä¸¾æ¥å®ç°å•ä¾‹æ¨¡å¼ã€‚ä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»º æ–°çš„å¯¹è±¡ã€‚</p>
<p>è¿™ç§æ–¹å¼ä¹Ÿæ˜¯ Effective Java ä½œè€… Josh Bloch æå€¡çš„æ–¹å¼</p>
</li>
<li>
<p>ç»“è®ºï¼šæ¨èä½¿ç”¨</p>
</li>
</ol>
<h2 id="åœ¨-jdk-åº”ç”¨çš„æºç åˆ†æ">åœ¨ JDK åº”ç”¨çš„æºç åˆ†æ</h2>
<h2 id="æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜">æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚è¯´æ˜</h2>
<ol>
<li>å•ä¾‹æ¨¡å¼ä¿è¯äº† ç³»ç»Ÿå†…å­˜ä¸­è¯¥ç±»åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼ŒèŠ‚çœäº†ç³»ç»Ÿèµ„æºï¼Œå¯¹äºä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºé”€æ¯çš„å¯¹è±¡ï¼Œä½¿ ç”¨å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿæ€§èƒ½</li>
<li>å½“æƒ³å®ä¾‹åŒ–ä¸€ä¸ªå•ä¾‹ç±»çš„æ—¶å€™ï¼Œå¿…é¡»è¦è®°ä½ä½¿ç”¨ç›¸åº”çš„è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ new</li>
<li>å•ä¾‹æ¨¡å¼ä½¿ç”¨çš„åœºæ™¯ï¼šéœ€è¦é¢‘ç¹çš„è¿›è¡Œåˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡ã€åˆ›å»ºå¯¹è±¡æ—¶è€—æ—¶è¿‡å¤šæˆ–è€—è´¹èµ„æºè¿‡å¤š(å³ï¼šé‡é‡çº§ å¯¹è±¡)ï¼Œä½†åˆç»å¸¸ç”¨åˆ°çš„å¯¹è±¡ã€å·¥å…·ç±»å¯¹è±¡ã€é¢‘ç¹è®¿é—®æ•°æ®åº“æˆ–æ–‡ä»¶çš„å¯¹è±¡(æ¯”å¦‚æ•°æ®æºã€session å·¥å‚ç­‰)</li>
</ol>
<h2 id="åœ¨é¡¹ç›®çš„åº”ç”¨">åœ¨é¡¹ç›®çš„åº”ç”¨</h2>
<h3 id="å·¥å•ç³»ç»Ÿä¼˜åŒ–ossclient">å·¥å•ç³»ç»Ÿä¼˜åŒ–ossClient</h3>
<p>èƒŒæ™¯: å·¥å•ç³»ç»Ÿä¸­å‘ç°æœ‰å¤§é‡ossClientè¿æ¥æœªå…³é—­,å¯¼è‡´ç³»ç»Ÿé¢‘ç¹GC</p>
<p>ä¿®æ”¹å‰:å‘ç°æ— è®ºæ˜¯å“ªä¸ªä¸Šä¼ å¯¹è±¡çš„æ–¹æ³•,éƒ½æ–°å¼€å¯äº†ä¸€ä¸ªossClient,ä¸”æœªå…³é—­</p>
<pre><code>public void uploadPic(File file) {

    OSSClient ossClient = new OSSClient(internalEndPoint, accessKeyId, accessKeySecret);
    if (!ossClient.doesBucketExist(bucketName)) {
        logger.error(&quot;æ‚¨çš„Bucketä¸å­˜åœ¨ï¼Œåˆ›å»ºBucketï¼š&quot; + bucketName + &quot;ã€‚&quot;);
        throw new RuntimeException(&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;);
    }

    String originalFilename = file.getName();
    String suffix = StringUtils.substringAfterLast(originalFilename, &quot;.&quot;);
    if (StringUtils.isBlank(suffix) || !this.isPicFile(suffix.toLowerCase())) {
        throw new IllegalArgumentException(&quot;ä¸Šä¼ æ–‡ä»¶ç±»å‹é”™è¯¯ï¼&quot;);
    }

    if (file.length() &gt; this.maxFileSize) {
        throw new IllegalArgumentException(&quot;ä¸Šä¼ æ–‡ä»¶å¤§å°è¶…å‡ºç³»ç»Ÿé™åˆ¶&quot;);
    }

    ossClient.putObject(bucketName, HttpUtils.concatUrl(path, originalFilename), file);
    logger.info(&quot;Objectï¼š,fileName:&quot; + originalFilename + &quot;ä¸Šä¼ æˆåŠŸã€‚&quot;);
}

public String uploadFile(File file) {

    OSSClient ossClient = new OSSClient(internalEndPoint, accessKeyId, accessKeySecret);
    if (!ossClient.doesBucketExist(bucketName)) {
        logger.error(&quot;æ‚¨çš„Bucketä¸å­˜åœ¨ï¼Œåˆ›å»ºBucketï¼š&quot; + bucketName + &quot;ã€‚&quot;);
        throw new RuntimeException(&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;);
    }

    String originalFilename = file.getName();
    String suffix = StringUtils.substringAfterLast(originalFilename, &quot;.&quot;);
    if (StringUtils.isBlank(suffix) || !this.isPicFile(suffix.toLowerCase())) {
        throw new IllegalArgumentException(&quot;ä¸Šä¼ æ–‡ä»¶ç±»å‹é”™è¯¯ï¼&quot;);
    }

    if (file.length() &gt; this.maxFileSize) {
        throw new IllegalArgumentException(&quot;ä¸Šä¼ æ–‡ä»¶å¤§å°è¶…å‡ºç³»ç»Ÿé™åˆ¶&quot;);
    }
    String fileKeyUrl =  HttpUtils.concatUrl(path, originalFilename);
    ossClient.putObject(bucketName, fileKeyUrl, file);
    logger.info(&quot;Objectï¼š,fileName:&quot; + originalFilename + &quot;ä¸Šä¼ æˆåŠŸã€‚&quot;);
    return HttpUtils.concatUrl(internalEndPoint,fileKeyUrl);
}
</code></pre>
<p>ä¿®æ”¹æ€è·¯:ä¸€å®šè¦å…³é—­è¿æ¥èµ„æº,æœ€å¥½èƒ½å¤Ÿå•ä¾‹åŒ–è¿æ¥</p>
<p>ä¿®æ”¹å:</p>
<pre><code>//è·å–è¿æ¥èµ„æº,è¿™é‡Œä½¿ç”¨åŒé‡æ£€æŸ¥æ–¹å¼.
//æ³¨æ„:è¿™é‡Œæ— æ³•ä¿è¯OSSClientæœ€å¤šæœ‰ä¸€ä¸ªå®ä¾‹,å› ä¸ºOSSClientä¸ºé˜¿é‡Œçš„å¼€æºåº“,å®ƒå¹¶æ²¡æœ‰ç§æœ‰çš„æ„é€ æ–¹æ³•
//è¦æƒ³ä¿è¯æœ€å¤šæœ‰ä¸€ä¸ªå®ä¾‹,è¦ä¿è¯æœ¬ç³»ç»Ÿä¸­,æ²¡æœ‰å…¶ä»–åœ°æ–¹æ²¡æœ‰new OSSClient
public OSSClient getOssClient() {
    if (ossClient == null) {
        synchronized (this) {
            if (ossClient == null) {
                ossClient = new OSSClient(internalEndPoint, accessKeyId, accessKeySecret);
                return ossClient;
            }
        }
    }
    return ossClient;
}
</code></pre>
<pre><code>public void uploadPic(File file) {

    OSSClient ossClient = getOssClient();
    if (!ossClient.doesBucketExist(bucketName)) {
        logger.error(&quot;æ‚¨çš„Bucketä¸å­˜åœ¨ï¼Œåˆ›å»ºBucketï¼š&quot; + bucketName + &quot;ã€‚&quot;);
        throw new RuntimeException(&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;);
    }

    String originalFilename = file.getName();
    String suffix = StringUtils.substringAfterLast(originalFilename, &quot;.&quot;);
    if (StringUtils.isBlank(suffix) || !this.isPicFile(suffix.toLowerCase())) {
        throw new IllegalArgumentException(&quot;ä¸Šä¼ æ–‡ä»¶ç±»å‹é”™è¯¯ï¼&quot;);
    }

    if (file.length() &gt; this.maxFileSize) {
        throw new IllegalArgumentException(&quot;ä¸Šä¼ æ–‡ä»¶å¤§å°è¶…å‡ºç³»ç»Ÿé™åˆ¶&quot;);
    }
</code></pre>
<h3 id="ä»»åŠ¡ç³»ç»Ÿä¼˜åŒ–ossclient">ä»»åŠ¡ç³»ç»Ÿä¼˜åŒ–ossClient</h3>
<pre><code>public class OssUtil {

   private static OSS ossClient;

   private static String bucketName = &quot;xxx&quot;;

   @PostConstruct
   private void init() {
      ossClient = new OSSClientBuilder().build(ossUrl, accessKeyId, accessKeySecret);
   }

   public static String upload(InputStream inputStream, String path) throws FileNotFoundException {
      try {
         // ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šçš„å­˜å‚¨ç©ºé—´ï¼ˆbucketNameï¼‰å¹¶å°†å…¶ä¿å­˜ä¸ºæŒ‡å®šçš„æ–‡ä»¶åç§°ï¼ˆobjectNameï¼‰ã€‚
         PutObjectResult putObjectResult = ossClient.putObject(bucketName, path, inputStream);
         return &quot;xxx/&quot; + path;
      } catch (Exception e) {
         log.error(&quot;ä¸Šä¼ æ–‡ä»¶åˆ°osså¤±è´¥&quot;, e);
         throw e;
      }
   }

   public static String uploadFile(File file, String path) throws FileNotFoundException {
      try {
         // ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šçš„å­˜å‚¨ç©ºé—´ï¼ˆbucketNameï¼‰å¹¶å°†å…¶ä¿å­˜ä¸ºæŒ‡å®šçš„æ–‡ä»¶åç§°ï¼ˆobjectNameï¼‰ã€‚
         PutObjectResult putObjectResult = ossClient.putObject(bucketName, path, file);
         return &quot;https://xxx/&quot; + path;
      } catch (Exception e) {
         log.error(&quot;ä¸Šä¼ æ–‡ä»¶åˆ°osså¤±è´¥&quot;, e);
         throw e;
      }
   }
}
</code></pre>
<p>@PostConstructæ³¨è§£çš„ä½œç”¨æ˜¯åœ¨Servletåˆå§‹åŒ–æ—¶,æ‰§è¡Œæ‰€æ³¨è§£çš„æ–¹æ³•.è€ŒServletåˆæ˜¯å•ä¾‹çš„,å…¶initæ–¹æ³•(éæœ¬ç³»ç»Ÿçš„æ–¹æ³•)åªä¼šæ‰§è¡Œä¸€æ¬¡,è¿™å°±ä¿è¯äº†ossClientæ˜¯å•ä¾‹çš„.</p>
<h3 id="å…¶ä»–ç³»ç»Ÿä¸­httpclientçš„å•ä¾‹åŒ–">å…¶ä»–ç³»ç»Ÿä¸­HttpClientçš„å•ä¾‹åŒ–</h3>
<pre><code>public class HttpUtils {
   private static Logger logger = LoggerFactory.getLogger(HttpUtils.class);
   //  å®¢æˆ·ç«¯ä»æœåŠ¡ç«¯è¯»å–æ•°æ®çš„è¶…æ—¶æ—¶é—´
    private static final int HTTP_TIMEOUT = 30000;
    //  å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´
    private static final int HTTP_CON_TIMEOUT = 5000;
    //  å®¢æˆ·ç«¯ä»è¿æ¥æ± ä¸­è·å–è¿æ¥çš„è¶…æ—¶æ—¶é—´
    private static final int HTTP_CON_REQ_TIMEOUT = 2000;
    //  è·¯ç”±çš„é»˜è®¤æœ€å¤§è¿æ¥
    private static final int HTTP_MAX_PERROUTE = 500;
    //  æ•´ä¸ªè¿æ¥æ± è¿æ¥çš„æœ€å¤§å€¼
    private static final int HTTP_MAX_TOTAL = 1000;
    private static RequestConfig defaultRequestConfig = null;
    private static CloseableHttpClient httpClient = null;
    
   static {
        //  åˆ›å»ºè¿æ¥æ± ç®¡ç†å™¨
        PoolingHttpClientConnectionManager connManager = new PoolingHttpClientConnectionManager();
        //  è®¾ç½®socketé…ç½®
        SocketConfig socketConfig = SocketConfig.custom()
                .setTcpNoDelay(true)
                .build();
        connManager.setDefaultSocketConfig(socketConfig);
        connManager.setMaxTotal(HTTP_MAX_TOTAL);
        connManager.setDefaultMaxPerRoute(HTTP_MAX_PERROUTE);
        //  è®¾ç½®è·å–è¿æ¥è¶…æ—¶æ—¶é—´ã€å»ºç«‹è¿æ¥è¶…æ—¶æ—¶é—´ã€ä»æœåŠ¡ç«¯è¯»å–æ•°æ®çš„è¶…æ—¶æ—¶é—´
        defaultRequestConfig = RequestConfig.custom()
                .setSocketTimeout(HTTP_TIMEOUT)
                .setConnectTimeout(HTTP_CON_TIMEOUT)
                .setConnectionRequestTimeout(HTTP_CON_REQ_TIMEOUT)
                .build();
        //  åˆ›å»ºhttpclientå®ä¾‹
        httpClient = HttpClients.custom()
                .setConnectionManager(connManager)
                .setDefaultRequestConfig(defaultRequestConfig)
                .build();
    }
   /**
    * postè¯·æ±‚
    * @param url
    * @param params
    * @return
    */
   public static String post(String url,Map&lt;String,String&gt; params){
      String html = &quot;&quot;;
      CloseableHttpResponse response = null;
      try {
         HttpPost post = new HttpPost(url);
         List&lt;NameValuePair&gt; nvps = new ArrayList&lt;NameValuePair&gt;();
         Set&lt;String&gt; keys = params.keySet();
         for (String key : keys) {
            nvps.add(new BasicNameValuePair(key, params.get(key)));
         }
         post.setEntity(new UrlEncodedFormEntity(nvps, &quot;UTF-8&quot;));
         
         response = httpClient.execute(post);
         if (response.getStatusLine().getStatusCode() == HttpServletResponse.SC_OK) {
            HttpEntity entity = response.getEntity();
            html = EntityUtils.toString(entity, &quot;UTF-8&quot;);
         }
      } catch (Exception e) {
         logger.error(&quot;&quot;,e);
      } finally {
         try {
            if(response != null) {
               response.close();
            }
         } catch (Exception e) {
            logger.error(&quot;&quot;,e);
         }
      }
      return html;
   }
}
</code></pre>
<p>æœ¬ä¾‹ä¸­æ˜¯é€šè¿‡staticé™æ€ä»£ç å—åªä¼šåŠ è½½ä¸€æ¬¡çš„ç‰¹æ€§ä¿è¯httpClientçš„å•ä¾‹</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<p>@PostConstruct</p>
<p>https://blog.csdn.net/karleraess/article/details/80536193</p>
<p>https://blog.csdn.net/xtss999/article/details/89139745</p>
<p>https://www.jianshu.com/p/98cf7d8b9ec3</p>
<p>Servlet</p>
<p>https://www.cnblogs.com/shawshawwan/p/9002126.html</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://21up.github.io/post/hello-gridea/</id>
        <link href="https://21up.github.io/post/hello-gridea/">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="https://gridea.dev/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>Windows</strong>ï¼Œ<strong>MacOS</strong> æˆ– <strong>Linux</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
</feed>